<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Harmonic Motion Simulator</title>
    <style>
        :root {
            --bg-dark: #121212;
            --bg-card: #1e1e1e;
            --accent: #ff7b00;
            --accent-light: #ff9a40;
            --text-primary: #ffffff;
            --text-secondary: #b0b0b0;
            --grid-line: rgba(255, 255, 255, 0.1);
            --grid-line-major: rgba(255, 255, 255, 0.2);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 24px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .logo-icon {
            color: var(--accent);
            font-size: 24px;
        }
        
        .logo-text {
            font-size: 20px;
            font-weight: 600;
        }
        
        nav {
            display: flex;
            gap: 8px;
        }
        
        .tab {
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
            position: relative;
            overflow: hidden;
        }
        
        .tab:hover {
            background-color: rgba(255, 123, 0, 0.1);
            color: var(--accent-light);
        }
        
        .tab.active {
            background-color: var(--accent);
            color: #000;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .card {
            background-color: var(--bg-card);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .card-title {
            font-size: 18px;
            font-weight: 600;
        }
        
        /* Simulator styles */
        .simulator-container {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
        }
        
        @media (max-width: 768px) {
            .simulator-container {
                grid-template-columns: 1fr;
            }
        }
        
        .simulation-view {
            height: 300px;
            background-color: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            position: relative;
            overflow: hidden;
        }
        
        .wall {
            position: absolute;
            left: 10%;
            top: 0;
            width: 10px;
            height: 100%;
            background-color: #444;
            border-right: 2px solid #666;
        }
        
        .spring {
            position: absolute;
            left: calc(10% + 10px);
            top: 50%;
            height: 8px;
            background-color: #888;
            transform: translateY(-50%);
        }
        
        .mass {
            position: absolute;
            width: 50px;
            height: 50px;
            background-color: var(--accent);
            border-radius: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            cursor: grab;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            z-index: 10;
        }
        
        .mass:active {
            cursor: grabbing;
        }
        
        .mass-label {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-weight: bold;
            color: #000;
        }
        
        .equilibrium-line {
            position: absolute;
            top: 0;
            height: 100%;
            width: 1px;
            background-color: rgba(255, 255, 255, 0.3);
            z-index: 5;
        }
        
        .controls {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .control-label {
            display: flex;
            justify-content: space-between;
            color: var(--text-secondary);
        }
        
        .slider-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .slider {
            flex: 1;
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 4px;
            background: #333;
            border-radius: 4px;
            outline: none;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--accent);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .slider::-webkit-slider-thumb:hover {
            background: var(--accent-light);
            transform: scale(1.2);
        }
        
        .slider-value {
            width: 40px;
            text-align: right;
            color: var(--accent);
            font-weight: 500;
        }
        
        .button {
            padding: 10px 16px;
            border: none;
            border-radius: 8px;
            background-color: var(--accent);
            color: black;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-top: 8px;
        }
        
        .button:hover {
            background-color: var(--accent-light);
            transform: translateY(-1px);
        }
        
        .button-outline {
            background-color: transparent;
            border: 1px solid var(--accent);
            color: var(--accent);
        }
        
        .button-outline:hover {
            background-color: rgba(255, 123, 0, 0.1);
        }
        
        .button-sm {
            padding: 4px 8px;
            font-size: 14px;
        }
        
        .charts-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .chart-card {
            height: 250px;
            position: relative;
        }
        
        .chart-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        /* Learn tab styles */
        .learn-container {
            display: grid;
            grid-template-columns: 1fr 3fr;
            gap: 20px;
        }
        
        @media (max-width: 768px) {
            .learn-container {
                grid-template-columns: 1fr;
            }
        }
        
        .learn-nav {
            position: sticky;
            top: 20px;
        }
        
        .learn-nav-item {
            padding: 10px 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 8px;
        }
        
        .learn-nav-item:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }
        
        .learn-nav-item.active {
            background-color: rgba(255, 123, 0, 0.2);
            color: var(--accent);
            font-weight: 500;
        }
        
        .learn-content {
            line-height: 1.6;
        }
        
        .learn-content h2 {
            margin: 24px 0 16px;
            color: var(--accent);
        }
        
        .learn-content h3 {
            margin: 20px 0 12px;
            color: var(--text-primary);
        }
        
        .learn-content p {
            margin-bottom: 16px;
            color: var(--text-secondary);
        }
        
        .learn-content ul, .learn-content ol {
            margin: 16px 0;
            padding-left: 24px;
            color: var(--text-secondary);
        }
        
        .learn-content li {
            margin-bottom: 8px;
        }
        
        .formula {
            background-color: rgba(0, 0, 0, 0.2);
            padding: 16px;
            border-radius: 8px;
            margin: 16px 0;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Times New Roman', serif;
            color: var(--accent-light);
            font-size: 20px;
        }
        
        /* Settings tab styles */
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .setting-label {
            color: var(--text-primary);
            font-weight: 500;
        }
        
        .setting-description {
            color: var(--text-secondary);
            font-size: 14px;
            margin-top: 4px;
        }
        
        .switch {
            position: relative;
            display: inline-block;
            width: 44px;
            height: 22px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider-toggle {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #333;
            -webkit-transition: .4s;
            transition: .4s;
            border-radius: 34px;
        }
        
        .slider-toggle:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 2px;
            background-color: white;
            -webkit-transition: .4s;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider-toggle {
            background-color: var(--accent);
        }
        
        input:focus + .slider-toggle {
            box-shadow: 0 0 1px var(--accent);
        }
        
        input:checked + .slider-toggle:before {
            -webkit-transform: translateX(20px);
            -ms-transform: translateX(20px);
            transform: translateX(20px);
        }
        
        .export-section {
            margin-top: 20px;
        }
        
        .file-input {
            display: none;
        }
        
        .file-input-label {
            display: inline-block;
            padding: 10px 16px;
            border: 1px solid var(--accent);
            border-radius: 8px;
            cursor: pointer;
            color: var(--accent);
            transition: all 0.2s ease;
            margin-right: 10px;
        }
        
        .file-input-label:hover {
            background-color: rgba(255, 123, 0, 0.1);
        }
        
        .data-capture {
            margin-top: 20px;
        }
        
        .captured-data {
            margin-top: 16px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th {
            background-color: rgba(0, 0, 0, 0.2);
            text-align: left;
            padding: 8px;
            color: var(--text-secondary);
            font-weight: 500;
        }
        
        td {
            padding: 8px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            color: var(--text-secondary);
        }
        
        .tooltip {
            position: relative;
            display: inline-block;
            margin-left: 4px;
        }
        
        .tooltip-icon {
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 14px;
        }
        
        .tooltip-text {
            visibility: hidden;
            width: 200px;
            background-color: #333;
            color: var(--text-secondary);
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 14px;
        }
        
        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <div class="logo-icon">⇌</div>
                <div class="logo-text">SHM Simulator</div>
            </div>
            <nav>
                <div class="tab active" data-tab="simulator">Simulator</div>
                <div class="tab" data-tab="learn">Learn</div>
                <div class="tab" data-tab="settings">Settings</div>
            </nav>
            <div style="position: fixed; bottom: 20px; right: 20px; z-index: 1000;">
                <a href="/" style="display: flex; align-items: center; justify-content: center; width: 50px; height: 50px; background-color: #121212; color: white; border-radius: 50%; box-shadow: 0 4px 8px rgba(0,0,0,0.3); text-decoration: none; transition: transform 0.3s ease, box-shadow 0.3s ease;" title="Back to Dashboard">
                  <i class="fas fa-home" style="font-size: 20px; color: white;"></i>
                </a>
            </div>
        </header>
        <!-- Simulator Tab -->
        <div class="tab-content active" id="simulator-tab">
            <div class="simulator-container">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Spring-Mass System</div>
                        <div class="tooltip">
                            <span class="tooltip-icon">?</span>
                            <span class="tooltip-text">Drag the mass to start oscillation</span>
                        </div>
                    </div>
                    <div class="simulation-view">
                        <div class="wall"></div>
                        <div class="spring" id="spring"></div>
                        <div class="equilibrium-line" id="equilibrium"></div>
                        <div class="mass" id="mass">
                            <div class="mass-label" id="mass-value">m</div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Parameters</div>
                    </div>
                    <div class="controls">
                        <div class="control-group">
                            <div class="control-label">
                                <span>Mass (kg)</span>
                                <span id="mass-display">1.0</span>
                            </div>
                            <div class="slider-container">
                                <input type="range" min="0.1" max="2" step="0.1" value="1" class="slider" id="mass-slider">
                            </div>
                        </div>
                        
                        <div class="control-group">
                            <div class="control-label">
                                <span>Spring Constant (N/m)</span>
                                <span id="k-display">10.0</span>
                            </div>
                            <div class="slider-container">
                                <input type="range" min="1" max="20" step="0.5" value="10" class="slider" id="k-slider">
                            </div>
                        </div>
                        
                        <div class="control-group">
                            <div class="control-label">
                                <span>Damping Coefficient</span>
                                <span id="damping-display">0.1</span>
                            </div>
                            <div class="slider-container">
                                <input type="range" min="0" max="1" step="0.01" value="0.1" class="slider" id="damping-slider">
                            </div>
                        </div>
                        
                        <div class="control-group">
                            <div class="control-label">
                                <span>Initial Displacement (m)</span>
                                <span id="displacement-display">0.5</span>
                            </div>
                            <div class="slider-container">
                                <input type="range" min="0" max="1" step="0.05" value="0.5" class="slider" id="displacement-slider">
                            </div>
                        </div>
                        
                        <div class="control-group">
                            <div class="control-label">
                                <span>Simulation Speed</span>
                                <span id="speed-display">1.0×</span>
                            </div>
                            <div class="slider-container">
                                <input type="range" min="0.1" max="2" step="0.1" value="1" class="slider" id="speed-slider">
                            </div>
                        </div>
                        
                        <div>
                            <button class="button" id="start-btn">Start</button>
                            <button class="button button-outline" id="reset-btn">Reset</button>
                            <button class="button button-outline" id="capture-btn">Capture Data Point</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="charts-container">
                <div class="card chart-card">
                    <div class="card-header">
                        <div class="card-title">Position vs Time</div>
                    </div>
                    <canvas class="chart-canvas" id="position-chart"></canvas>
                </div>
                
                <div class="card chart-card">
                    <div class="card-header">
                        <div class="card-title">Velocity vs Time</div>
                    </div>
                    <canvas class="chart-canvas" id="velocity-chart"></canvas>
                </div>
                
                <div class="card chart-card">
                    <div class="card-header">
                        <div class="card-title">Acceleration vs Time</div>
                    </div>
                    <canvas class="chart-canvas" id="acceleration-chart"></canvas>
                </div>
                
                <div class="card chart-card">
                    <div class="card-header">
                        <div class="card-title">Phase Space Diagram</div>
                        <div class="tooltip">
                            <span class="tooltip-icon">?</span>
                            <span class="tooltip-text">Position vs Velocity</span>
                        </div>
                    </div>
                    <canvas class="chart-canvas" id="phase-chart"></canvas>
                </div>
            </div>
            
            <div class="card data-capture">
                <div class="card-header">
                    <div class="card-title">Captured Data Points</div>
                    <button class="button button-sm" id="clear-data-btn">Clear Data</button>
                </div>
                <div class="captured-data">
                    <table>
                        <thead>
                            <tr>
                                <th>Time (s)</th>
                                <th>Position (m)</th>
                                <th>Velocity (m/s)</th>
                                <th>Acceleration (m/s²)</th>
                                <th>Energy (J)</th>
                            </tr>
                        </thead>
                        <tbody id="data-table-body">
                            <!-- Data rows will be inserted here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Learn Tab -->
        <div class="tab-content" id="learn-tab">
            <div class="learn-container">
                <div class="card learn-nav">
                    <div class="learn-nav-item active" data-section="introduction">Introduction</div>
                    <div class="learn-nav-item" data-section="harmonic-motion">Harmonic Motion</div>
                    <div class="learn-nav-item" data-section="energy">Energy in SHM</div>
                    <div class="learn-nav-item" data-section="damping">Damping</div>
                    <div class="learn-nav-item" data-section="waves">Properties of Waves</div>
                </div>
                
                <div class="card learn-content">
                    <div class="learn-section active" id="introduction">
                        <h2>Introduction to Oscillations and Waves</h2>
                        <p>
                            Oscillatory motion is one of the most important types of motion in physics, occurring in mechanical systems, electrical circuits, and even in quantum mechanics. This simulator helps you understand the principles of Simple Harmonic Motion (SHM), which is the most basic form of oscillatory motion.
                        </p>
                        <p>
                            In this learning module, we will explore concepts from Unit 1, Module 2: Oscillations and Waves as outlined in the CAPE Physics curriculum.
                        </p>
                    </div>
                    
                    <div class="learn-section" id="harmonic-motion">
                        <h2>Harmonic Motion</h2>
                        <p>
                            Simple Harmonic Motion (SHM) occurs when a body is subjected to a restoring force that is proportional to the displacement from equilibrium and in the opposite direction.
                        </p>
                        
                        <h3>Period of Simple Pendulum</h3>
                        <p>
                            For a simple pendulum, the period is given by:
                        </p>
                        <div class="formula">
                            T = 2π√(L/g)
                        </div>
                        <p>
                            Where L is the length of the pendulum and g is the acceleration due to gravity.
                        </p>
                        
                        <h3>Period of Mass on a Spring</h3>
                        <p>
                            For a mass on a spring, the period is given by:
                        </p>
                        <div class="formula">
                            T = 2π√(m/k)
                        </div>
                        <p>
                            Where m is the mass and k is the spring constant.
                        </p>
                        
                        <h3>Equation of Motion</h3>
                        <p>
                            The displacement of a body undergoing SHM can be described by:
                        </p>
                        <div class="formula">
                            x = A cos(ωt + φ)
                        </div>
                        <p>
                            Where A is the amplitude, ω is the angular frequency, and φ is the phase constant.
                        </p>
                        
                        <h3>Angular Frequency</h3>
                        <p>
                            The angular frequency ω is related to the period T by:
                        </p>
                        <div class="formula">
                            ω = 2π/T = √(k/m)
                        </div>
                    </div>
                    
                    <div class="learn-section" id="energy">
                        <h2>Energy in Simple Harmonic Motion</h2>
                        <p>
                            In SHM, there is a continuous interchange between kinetic and potential energy while the total energy remains constant (in the absence of damping).
                        </p>
                        
                        <h3>Kinetic Energy</h3>
                        <p>
                            The kinetic energy of a body in SHM is given by:
                        </p>
                        <div class="formula">
                            KE = ½mv² = ½mω²A² sin²(ωt + φ)
                        </div>
                        
                        <h3>Potential Energy</h3>
                        <p>
                            The potential energy is given by:
                        </p>
                        <div class="formula">
                            PE = ½kx² = ½kA² cos²(ωt + φ)
                        </div>
                        
                        <h3>Total Energy</h3>
                        <p>
                            The total energy remains constant:
                        </p>
                        <div class="formula">
                            E = KE + PE = ½kA² = ½mω²A²
                        </div>
                    </div>
                    
                    <div class="learn-section" id="damping">
                        <h2>Damped Oscillations and Resonance</h2>
                        <p>
                            In real systems, energy is gradually dissipated due to friction and other resistive forces, leading to damped oscillations.
                        </p>
                        
                        <h3>Equation of Damped Motion</h3>
                        <p>
                            The displacement in damped oscillation is given by:
                        </p>
                        <div class="formula">
                            x = Ae<sup>-bt/2m</sup> cos(ω't + φ)
                        </div>
                        <p>
                            Where b is the damping constant and ω' is the angular frequency of the damped oscillation.
                        </p>
                        
                        <h3>Types of Damping</h3>
                        <ul>
                            <li><strong>Light damping:</strong> Oscillation amplitude gradually decreases</li>
                            <li><strong>Critical damping:</strong> System returns to equilibrium in the shortest time without oscillation</li>
                            <li><strong>Heavy damping:</strong> System returns slowly to equilibrium without oscillation</li>
                        </ul>
                        
                        <h3>Real-life Examples</h3>
                        <p>
                            Damping is utilized in many real-life situations, such as:
                        </p>
                        <ul>
                            <li>Shock absorbers in vehicles</li>
                            <li>Door closers</li>
                            <li>Electrical circuits with resistors</li>
                        </ul>
                    </div>
                    
                    <div class="learn-section" id="waves">
                        <h2>Properties of Waves</h2>
                        <p>
                            Waves are disturbances that transfer energy from one point to another without the transfer of matter.
                        </p>
                        
                        <h3>Wave Terminology</h3>
                        <ul>
                            <li><strong>Displacement:</strong> The distance of a point from its equilibrium position</li>
                            <li><strong>Amplitude:</strong> The maximum displacement from the equilibrium position</li>
                            <li><strong>Period:</strong> The time taken for one complete oscillation</li>
                            <li><strong>Frequency:</strong> The number of oscillations per unit time</li>
                            <li><strong>Wavelength:</strong> The distance between two consecutive points in phase</li>
                        </ul>
                        
                        <h3>Types of Waves</h3>
                        <p>
                            Waves can be classified into two main types based on the direction of particle movement relative to the direction of wave propagation:
                        </p>
                        <ul>
                            <li>
                                <strong>Transverse waves:</strong> Particles move perpendicular to the direction of wave propagation
                                <ul>
                                    <li>Example: Light waves, water waves</li>
                                </ul>
                            </li>
                            <li>
                                <strong>Longitudinal waves:</strong> Particles move parallel to the direction of wave propagation
                                <ul>
                                    <li>Example: Sound waves, compression waves in springs</li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Settings Tab -->
        <div class="tab-content" id="settings-tab">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Display Settings</div>
                </div>
                <div class="settings-grid">
                    <div class="setting-item">
                        <div>
                            <div class="setting-label">Position Graph</div>
                            <div class="setting-description">Show position vs time graph</div>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="toggle-position" checked>
                            <span class="slider-toggle"></span>
                        </label>
                    </div>
                    
                    <div class="setting-item">
                        <div>
                            <div class="setting-label">Velocity Graph</div>
                            <div class="setting-description">Show velocity vs time graph</div>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="toggle-velocity" checked>
                            <span class="slider-toggle"></span>
                        </label>
                    </div>
                    
                    <div class="setting-item">
                        <div>
                            <div class="setting-label">Acceleration Graph</div>
                            <div class="setting-description">Show acceleration vs time graph</div>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="toggle-acceleration" checked>
                            <span class="slider-toggle"></span>
                        </label>
                    </div>
                    
                    <div class="setting-item">
                        <div>
                            <div class="setting-label">Phase Space Graph</div>
                            <div class="setting-description">Show position vs velocity graph</div>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="toggle-phase" checked>
                            <span class="slider-toggle"></span>
                        </label>
                    </div>
                    
                    <div class="setting-item">
                        <div>
                            <div class="setting-label">Dark Theme</div>
                            <div class="setting-description">Use dark color scheme</div>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="toggle-theme" checked>
                            <span class="slider-toggle"></span>
                        </label>
                    </div>
                    
                    <div class="setting-item">
                        <div>
                            <div class="setting-label">Show Grid Lines</div>
                            <div class="setting-description">Display grid lines on graphs</div>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="toggle-grid" checked>
                            <span class="slider-toggle"></span>
                        </label>
                    </div>
                    
                    <div class="setting-item">
                        <div>
                            <div class="setting-label">Auto-scale Graphs</div>
                            <div class="setting-description">Automatically adjust graph scales</div>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="toggle-autoscale" checked>
                            <span class="slider-toggle"></span>
                        </label>
                    </div>
                </div>
            </div>
            
            <div class="card export-section">
                <div class="card-header">
                    <div class="card-title">Import/Export Data</div>
                </div>
                <div>
                    <p class="setting-description">Import or export simulation parameters and captured data points</p>
                    <div style="margin-top: 16px;">
                        <label for="import-file" class="file-input-label">Import Data</label>
                        <input type="file" id="import-file" class="file-input" accept=".json">
                        <button class="button" id="export-btn">Export Data</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Import Chart.js for graphs -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.1/chart.min.js"></script>
    
    <script>
        // DOM Elements
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        const learnNavItems = document.querySelectorAll('.learn-nav-item');
        const learnSections = document.querySelectorAll('.learn-section');
        const massSlider = document.getElementById('mass-slider');
        const massDisplay = document.getElementById('mass-display');
        const kSlider = document.getElementById('k-slider');
        const kDisplay = document.getElementById('k-display');
        const dampingSlider = document.getElementById('damping-slider');
        const dampingDisplay = document.getElementById('damping-display');
        const displacementSlider = document.getElementById('displacement-slider');
        const displacementDisplay = document.getElementById('displacement-display');
        const speedSlider = document.getElementById('speed-slider');
        const speedDisplay = document.getElementById('speed-display');
        const startBtn = document.getElementById('start-btn');
        const resetBtn = document.getElementById('reset-btn');
        const captureBtn = document.getElementById('capture-btn');
        const clearDataBtn = document.getElementById('clear-data-btn');
        const dataTableBody = document.getElementById('data-table-body');
        const mass = document.getElementById('mass');
        const spring = document.getElementById('spring');
        const equilibrium = document.getElementById('equilibrium');
        const massValue = document.getElementById('mass-value');
        const exportBtn = document.getElementById('export-btn');
        const importFile = document.getElementById('import-file');
        const toggles = {
            position: document.getElementById('toggle-position'),
            velocity: document.getElementById('toggle-velocity'),
            acceleration: document.getElementById('toggle-acceleration'),
            phase: document.getElementById('toggle-phase'),
            theme: document.getElementById('toggle-theme'),
            grid: document.getElementById('toggle-grid'),
            autoscale: document.getElementById('toggle-autoscale')
        };
        
        // Simulation variables
        let simulationRunning = false;
        let time = 0;
        let lastTime = 0;
        let animationFrameId;
        let capturedData = [];
        
        // Physics parameters
        let params = {
            mass: 1.0,
            k: 10.0,
            damping: 0.1,
            initialDisplacement: 0.5,
            speed: 1.0
        };
        
        // Derived parameters
        let omega;  // Angular frequency
        let position = 0;
        let velocity = 0;
        let acceleration = 0;
        
        // Animation & simulation timing variables
        let lastTimestamp = 0;
        const simulationView = document.querySelector('.simulation-view');
        const viewWidth = simulationView.clientWidth;
        const viewHeight = simulationView.clientHeight;
        const restPositionX = viewWidth * 0.5; // Equilibrium position
        const maxDisplacement = viewWidth * 0.3; // Maximum displacement in pixels
        
        // Set equilibrium line position
        equilibrium.style.left = `${restPositionX}px`;
        
        // Charts data
        const chartData = {
            position: {
                labels: [],
                datasets: [{
                    label: 'Position (m)',
                    data: [],
                    borderColor: '#ff7b00',
                    backgroundColor: 'rgba(255, 123, 0, 0.1)',
                    borderWidth: 2,
                    pointRadius: 0,
                    tension: 0.4
                }]
            },
            velocity: {
                labels: [],
                datasets: [{
                    label: 'Velocity (m/s)',
                    data: [],
                    borderColor: '#4a9eff',
                    backgroundColor: 'rgba(74, 158, 255, 0.1)',
                    borderWidth: 2,
                    pointRadius: 0,
                    tension: 0.4
                }]
            },
            acceleration: {
                labels: [],
                datasets: [{
                    label: 'Acceleration (m/s²)',
                    data: [],
                    borderColor: '#ff4a4a',
                    backgroundColor: 'rgba(255, 74, 74, 0.1)',
                    borderWidth: 2,
                    pointRadius: 0,
                    tension: 0.4
                }]
            },
            phase: {
                datasets: [{
                    label: 'Phase Space',
                    data: [],
                    borderColor: '#4aff4a',
                    backgroundColor: 'rgba(74, 255, 74, 0.1)',
                    borderWidth: 2,
                    pointRadius: 0,
                    showLine: true
                }]
            }
        };
        
        // Chart configuration
        const chartOptions = {
            responsive: true,
            maintainAspectRatio: false,
            animation: {
                duration: 0
            },
            scales: {
                x: {
                    grid: {
                        color: 'rgba(255, 255, 255, 0.1)'
                    },
                    ticks: {
                        color: 'rgba(255, 255, 255, 0.7)'
                    }
                },
                y: {
                    grid: {
                        color: 'rgba(255, 255, 255, 0.1)'
                    },
                    ticks: {
                        color: 'rgba(255, 255, 255, 0.7)'
                    }
                }
            },
            plugins: {
                legend: {
                    labels: {
                        color: 'rgba(255, 255, 255, 0.7)'
                    }
                }
            }
        };
        
        // Create charts
        const positionChart = new Chart(
            document.getElementById('position-chart').getContext('2d'),
            {
                type: 'line',
                data: chartData.position,
                options: {
                    ...chartOptions,
                    scales: {
                        ...chartOptions.scales,
                        x: {
                            ...chartOptions.scales.x,
                            title: {
                                display: true,
                                text: 'Time (s)',
                                color: 'rgba(255, 255, 255, 0.7)'
                            }
                        },
                        y: {
                            ...chartOptions.scales.y,
                            title: {
                                display: true,
                                text: 'Position (m)',
                                color: 'rgba(255, 255, 255, 0.7)'
                            }
                        }
                    }
                }
            }
        );
        
        const velocityChart = new Chart(
            document.getElementById('velocity-chart').getContext('2d'),
            {
                type: 'line',
                data: chartData.velocity,
                options: {
                    ...chartOptions,
                    scales: {
                        ...chartOptions.scales,
                        x: {
                            ...chartOptions.scales.x,
                            title: {
                                display: true,
                                text: 'Time (s)',
                                color: 'rgba(255, 255, 255, 0.7)'
                            }
                        },
                        y: {
                            ...chartOptions.scales.y,
                            title: {
                                display: true,
                                text: 'Velocity (m/s)',
                                color: 'rgba(255, 255, 255, 0.7)'
                            }
                        }
                    }
                }
            }
        );
        
        const accelerationChart = new Chart(
            document.getElementById('acceleration-chart').getContext('2d'),
            {
                type: 'line',
                data: chartData.acceleration,
                options: {
                    ...chartOptions,
                    scales: {
                        ...chartOptions.scales,
                        x: {
                            ...chartOptions.scales.x,
                            title: {
                                display: true,
                                text: 'Time (s)',
                                color: 'rgba(255, 255, 255, 0.7)'
                            }
                        },
                        y: {
                            ...chartOptions.scales.y,
                            title: {
                                display: true,
                                text: 'Acceleration (m/s²)',
                                color: 'rgba(255, 255, 255, 0.7)'
                            }
                        }
                    }
                }
            }
        );
        
        const phaseChart = new Chart(
            document.getElementById('phase-chart').getContext('2d'),
            {
                type: 'scatter',
                data: chartData.phase,
                options: {
                    ...chartOptions,
                    scales: {
                        ...chartOptions.scales,
                        x: {
                            ...chartOptions.scales.x,
                            title: {
                                display: true,
                                text: 'Position (m)',
                                color: 'rgba(255, 255, 255, 0.7)'
                            }
                        },
                        y: {
                            ...chartOptions.scales.y,
                            title: {
                                display: true,
                                text: 'Velocity (m/s)',
                                color: 'rgba(255, 255, 255, 0.7)'
                            }
                        }
                    }
                }
            }
        );
        
        // Initialize the simulation
        function initSimulation() {
            // Calculate derived parameters
            omega = Math.sqrt(params.k / params.mass);
            
            // Set initial conditions
            position = params.initialDisplacement;
            velocity = 0;
            updateAcceleration();
            
            // Update UI
            updateMassPosition();
            updateSpring();
            
            // Update sliders and displays
            massSlider.value = params.mass;
            massDisplay.textContent = params.mass.toFixed(1);
            massValue.textContent = params.mass.toFixed(1);
            kSlider.value = params.k;
            kDisplay.textContent = params.k.toFixed(1);
            dampingSlider.value = params.damping;
            dampingDisplay.textContent = params.damping.toFixed(2);
            displacementSlider.value = params.initialDisplacement;
            displacementDisplay.textContent = params.initialDisplacement.toFixed(2);
            speedSlider.value = params.speed;
            speedDisplay.textContent = params.speed.toFixed(1) + '×';
            
            // Reset chart data
            chartData.position.labels = [];
            chartData.position.datasets[0].data = [];
            chartData.velocity.labels = [];
            chartData.velocity.datasets[0].data = [];
            chartData.acceleration.labels = [];
            chartData.acceleration.datasets[0].data = [];
            chartData.phase.datasets[0].data = [];
            
            time = 0;
            lastTime = 0;
            updateCharts();
        }
        
        // Update the acceleration based on current position and velocity
        function updateAcceleration() {
            // F = -kx - bv, a = F/m
            acceleration = (-params.k * position - params.damping * velocity) / params.mass;
        }
        
        // Update mass position based on simulation
        function updateMassPosition() {
            // Convert from simulation units to screen units
            const screenX = restPositionX + position * maxDisplacement;
            mass.style.left = `${screenX}px`;
        }
        
        // Update spring appearance
        function updateSpring() {
            const wallX = parseInt(document.querySelector('.wall').style.left) || 0.1 * viewWidth;
            const massX = parseFloat(mass.style.left) || restPositionX;
            const springLength = massX - wallX - 10; // 10px offset for wall width
            
            spring.style.width = `${springLength}px`;
        }
        
        // Update simulation state
        function updateSimulation(deltaTime) {
            // Scale deltaTime by simulation speed
            const dt = deltaTime * params.speed;
            
            // Use Velocity Verlet integration for more accurate physics
            // Update position using current velocity and half acceleration
            position += velocity * dt + 0.5 * acceleration * dt * dt;
            
            // Store current acceleration
            const oldAcceleration = acceleration;
            
            // Calculate new acceleration based on new position
            updateAcceleration();
            
            // Update velocity using average of old and new acceleration
            velocity += 0.5 * (oldAcceleration + acceleration) * dt;
            
            // Update visuals
            updateMassPosition();
            updateSpring();
            
            // Update time and data points for charts
            time += dt;
            
            // Only add data points at certain intervals to prevent chart overcrowding
            const dataInterval = 0.05; // seconds
            if (time - lastTime >= dataInterval) {
                lastTime = time;
                
                // Add data to charts
                chartData.position.labels.push(time.toFixed(2));
                chartData.position.datasets[0].data.push(position);
                
                chartData.velocity.labels.push(time.toFixed(2));
                chartData.velocity.datasets[0].data.push(velocity);
                
                chartData.acceleration.labels.push(time.toFixed(2));
                chartData.acceleration.datasets[0].data.push(acceleration);
                
                chartData.phase.datasets[0].data.push({
                    x: position,
                    y: velocity
                });
                
                // Limit data points to prevent performance issues
                const maxDataPoints = 100;
                if (chartData.position.labels.length > maxDataPoints) {
                    chartData.position.labels.shift();
                    chartData.position.datasets[0].data.shift();
                    chartData.velocity.labels.shift();
                    chartData.velocity.datasets[0].data.shift();
                    chartData.acceleration.labels.shift();
                    chartData.acceleration.datasets[0].data.shift();
                }
                
                // Keep phase space data more for better visualization
                if (chartData.phase.datasets[0].data.length > maxDataPoints * 2) {
                    chartData.phase.datasets[0].data.shift();
                }
                
                updateCharts();
            }
        }
        
        // Update all charts
        function updateCharts() {
            positionChart.update();
            velocityChart.update();
            accelerationChart.update();
            phaseChart.update();
        }
        
        // Animation loop
        function animate(timestamp) {
            if (!lastTimestamp) {
                lastTimestamp = timestamp;
                animationFrameId = requestAnimationFrame(animate);
                return;
            }
            
            const deltaTime = (timestamp - lastTimestamp) / 1000; // Convert to seconds
            lastTimestamp = timestamp;
            
            updateSimulation(deltaTime);
            
            if (simulationRunning) {
                animationFrameId = requestAnimationFrame(animate);
            }
        }
        
        // Start the simulation
        function startSimulation() {
            if (!simulationRunning) {
                simulationRunning = true;
                startBtn.textContent = 'Pause';
                lastTimestamp = 0;
                animationFrameId = requestAnimationFrame(animate);
            } else {
                simulationRunning = false;
                startBtn.textContent = 'Resume';
                cancelAnimationFrame(animationFrameId);
            }
        }
        
        // Reset the simulation
        function resetSimulation() {
            // Stop animation if running
            if (simulationRunning) {
                simulationRunning = false;
                startBtn.textContent = 'Start';
                cancelAnimationFrame(animationFrameId);
            }
            
            // Clear captured data
            capturedData = [];
            dataTableBody.innerHTML = '';
            
            // Reset simulation params
            initSimulation();
        }
        
        // Capture a data point
        function captureDataPoint() {
            const energy = 0.5 * params.k * position * position + 0.5 * params.mass * velocity * velocity;
            
            const dataPoint = {
                time: time.toFixed(2),
                position: position.toFixed(3),
                velocity: velocity.toFixed(3),
                acceleration: acceleration.toFixed(3),
                energy: energy.toFixed(3)
            };
            
            capturedData.push(dataPoint);
            
            // Add to table
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${dataPoint.time}</td>
                <td>${dataPoint.position}</td>
                <td>${dataPoint.velocity}</td>
                <td>${dataPoint.acceleration}</td>
                <td>${dataPoint.energy}</td>
            `;
            
            dataTableBody.appendChild(row);
            
            // Scroll to the bottom of the table
            const capturedDataContainer = document.querySelector('.captured-data');
            capturedDataContainer.scrollTop = capturedDataContainer.scrollHeight;
        }
        
        // Export data
        function exportData() {
            const exportData = {
                parameters: params,
                capturedData: capturedData
            };
            
            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = 'shm_simulation_data.json';
            document.body.appendChild(a);
            a.click();
            
            // Clean up
            setTimeout(() => {
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }, 0);
        }
        
        // Import data
        function importData(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    if (importedData.parameters) {
                        params = importedData.parameters;
                    }
                    
                    if (importedData.capturedData) {
                        capturedData = importedData.capturedData;
                        
                        // Update table
                        dataTableBody.innerHTML = '';
                        capturedData.forEach(dataPoint => {
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td>${dataPoint.time}</td>
                                <td>${dataPoint.position}</td>
                                <td>${dataPoint.velocity}</td>
                                <td>${dataPoint.acceleration}</td>
                                <td>${dataPoint.energy}</td>
                            `;
                            dataTableBody.appendChild(row);
                        });
                    }
                    
                    resetSimulation();
                    alert('Data imported successfully!');
                } catch (error) {
                    alert('Error importing data: ' + error.message);
                }
            };
            reader.readAsText(file);
        }
        
        // Make the mass draggable
        let isDragging = false;
        
        mass.addEventListener('mousedown', (e) => {
            if (simulationRunning) return;
            isDragging = true;
            document.addEventListener('mousemove', handleDrag);
            document.addEventListener('mouseup', stopDrag);
            mass.style.cursor = 'grabbing';
        });
        
        function handleDrag(e) {
            if (!isDragging) return;
            
            // Get cursor position relative to simulation view
            const rect = simulationView.getBoundingClientRect();
            let x = e.clientX - rect.left;
            
            // Constrain to valid range
            const minX = restPositionX - maxDisplacement;
            const maxX = restPositionX + maxDisplacement;
            x = Math.min(Math.max(x, minX), maxX);
            
            // Update mass position
            mass.style.left = `${x}px`;
            
            // Update spring
            updateSpring();
            
            // Update simulation position
            position = (x - restPositionX) / maxDisplacement;
            displacementSlider.value = Math.abs(position);
            displacementDisplay.textContent = Math.abs(position).toFixed(2);
            params.initialDisplacement = Math.abs(position);
            
            // Update acceleration
            updateAcceleration();
            
            // Update charts
            chartData.position.datasets[0].data = [position];
            chartData.velocity.datasets[0].data = [0]; // Velocity is 0 when manually positioned
            chartData.acceleration.datasets[0].data = [acceleration];
            chartData.phase.datasets[0].data = [{x: position, y: 0}];
            chartData.position.labels = [0];
            chartData.velocity.labels = [0];
            chartData.acceleration.labels = [0];
            
            updateCharts();
        }
        
        function stopDrag() {
            isDragging = false;
            document.removeEventListener('mousemove', handleDrag);
            document.removeEventListener('mouseup', stopDrag);
            mass.style.cursor = 'grab';
            
            // Reset time and charts for new simulation
            time = 0;
            lastTime = 0;
            chartData.position.labels = [];
            chartData.position.datasets[0].data = [];
            chartData.velocity.labels = [];
            chartData.velocity.datasets[0].data = [];
            chartData.acceleration.labels = [];
            chartData.acceleration.datasets[0].data = [];
            chartData.phase.datasets[0].data = [];
        }
        
        // Tab navigation
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                tabs.forEach(t => t.classList.remove('active'));
                tabContents.forEach(content => content.classList.remove('active'));
                
                tab.classList.add('active');
                document.getElementById(`${tab.dataset.tab}-tab`).classList.add('active');
            });
        });
        
        // Learn tab navigation
        learnNavItems.forEach(item => {
            item.addEventListener('click', () => {
                learnNavItems.forEach(i => i.classList.remove('active'));
                learnSections.forEach(section => section.classList.remove('active'));
                
                item.classList.add('active');
                const targetSection = document.getElementById(item.dataset.section);
                targetSection.classList.add('active');
                
                // Smooth scroll to the section
                targetSection.scrollIntoView({ behavior: 'smooth' });
            });
        });
        
        // Slider event handlers
        massSlider.addEventListener('input', (e) => {
            params.mass = parseFloat(e.target.value);
            massDisplay.textContent = params.mass.toFixed(1);
            massValue.textContent = params.mass.toFixed(1);
            omega = Math.sqrt(params.k / params.mass);
            updateAcceleration();
        });
        
        kSlider.addEventListener('input', (e) => {
            params.k = parseFloat(e.target.value);
            kDisplay.textContent = params.k.toFixed(1);
            omega = Math.sqrt(params.k / params.mass);
            updateAcceleration();
        });
        
        dampingSlider.addEventListener('input', (e) => {
            params.damping = parseFloat(e.target.value);
            dampingDisplay.textContent = params.damping.toFixed(2);
            updateAcceleration();
        });
        
        displacementSlider.addEventListener('input', (e) => {
            params.initialDisplacement = parseFloat(e.target.value);
            displacementDisplay.textContent = params.initialDisplacement.toFixed(2);
            
            if (!simulationRunning) {
                position = params.initialDisplacement;
                updateMassPosition();
                updateSpring();
                updateAcceleration();
            }
        });
        
        speedSlider.addEventListener('input', (e) => {
            params.speed = parseFloat(e.target.value);
            speedDisplay.textContent = params.speed.toFixed(1) + '×';
        });
        
        // Button event handlers
        startBtn.addEventListener('click', startSimulation);
        resetBtn.addEventListener('click', resetSimulation);
        captureBtn.addEventListener('click', captureDataPoint);
        clearDataBtn.addEventListener('click', () => {
            capturedData = [];
            dataTableBody.innerHTML = '';
        });
        exportBtn.addEventListener('click', exportData);
        importFile.addEventListener('change', importData);
        
        // Toggle chart visibility
        Object.entries(toggles).forEach(([key, toggle]) => {
            if (!toggle) return;
            
            toggle.addEventListener('change', (e) => {
                if (key === 'position') {
                    document.querySelector('.chart-card:nth-child(1)').style.display = e.target.checked ? 'block' : 'none';
                } else if (key === 'velocity') {
                    document.querySelector('.chart-card:nth-child(2)').style.display = e.target.checked ? 'block' : 'none';
                } else if (key === 'acceleration') {
                    document.querySelector('.chart-card:nth-child(3)').style.display = e.target.checked ? 'block' : 'none';
                } else if (key === 'phase') {
                    document.querySelector('.chart-card:nth-child(4)').style.display = e.target.checked ? 'block' : 'none';
                } else if (key === 'grid') {
                    const color = e.target.checked ? 'rgba(255, 255, 255, 0.1)' : 'transparent';
                    positionChart.options.scales.x.grid.color = color;
                    positionChart.options.scales.y.grid.color = color;
                    velocityChart.options.scales.x.grid.color = color;
                    velocityChart.options.scales.y.grid.color = color;
                    accelerationChart.options.scales.x.grid.color = color;
                    accelerationChart.options.scales.y.grid.color = color;
                    phaseChart.options.scales.x.grid.color = color;
                    phaseChart.options.scales.y.grid.color = color;
                    updateCharts();
                } else if (key === 'theme') {
                    // This would toggle light/dark theme - we're keeping dark theme only for now
                }
            });
        });
        
        // Initialize the simulation on page load
        initSimulation();
        
        // Adjusting the charts container layout when charts are toggled
        const updateChartsLayout = () => {
            const visibleCharts = Array.from(document.querySelectorAll('.chart-card')).filter(
                chart => chart.style.display !== 'none'
            );
            
            const chartsContainer = document.querySelector('.charts-container');
            
            if (visibleCharts.length === 1) {
                chartsContainer.style.gridTemplateColumns = '1fr';
            } else if (visibleCharts.length === 2) {
                chartsContainer.style.gridTemplateColumns = '1fr 1fr';
            } else if (visibleCharts.length === 3) {
                chartsContainer.style.gridTemplateColumns = '1fr 1fr 1fr';
            } else {
                chartsContainer.style.gridTemplateColumns = 'repeat(auto-fit, minmax(300px, 1fr))';
            }
        };
        
        // Add event listeners to update the chart layout when toggles change
        toggles.position?.addEventListener('change', updateChartsLayout);
        toggles.velocity?.addEventListener('change', updateChartsLayout);
        toggles.acceleration?.addEventListener('change', updateChartsLayout);
        toggles.phase?.addEventListener('change', updateChartsLayout);
    </script>
</body>
</html>